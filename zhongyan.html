<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æš—å¤œé€ƒç”Ÿ - ææ€–ç”Ÿå­˜æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #ccc;
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            user-select: none;
            height: 100vh;
            perspective: 1000px;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #111;
            overflow: hidden;
        }
        
        #scene {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: transform 0.3s, filter 0.5s;
            transform-style: preserve-3d;
        }
        
        #ui {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            text-align: center;
            z-index: 10;
        }
        
        #health-bar {
            width: 200px;
            height: 20px;
            background-color: #300;
            margin: 0 auto 10px;
            border: 1px solid #500;
            position: relative;
        }
        
        #health-fill {
            height: 100%;
            width: 100%;
            background-color: #a00;
            transition: width 0.3s;
        }
        
        #message {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-left: 3px solid #a00;
            margin: 10px 0;
            display: none;
        }
        
        #inventory {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            display: none;
        }
        
        .inventory-item {
            width: 50px;
            height: 50px;
            background-color: rgba(100, 0, 0, 0.3);
            margin: 5px;
            display: inline-block;
            border: 1px solid #500;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
        }
        
        #actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            background-color: rgba(50, 0, 0, 0.7);
            color: #ccc;
            border: 1px solid #a00;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background-color: rgba(100, 0, 0, 0.7);
            color: #fff;
        }
        
        #menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #menu h1 {
            color: #a00;
            font-size: 3em;
            text-shadow: 0 0 10px #f00;
            margin-bottom: 30px;
        }
        
        .menu-btn {
            background-color: #300;
            color: #ccc;
            border: 1px solid #a00;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            width: 200px;
            text-align: center;
        }
        
        .menu-btn:hover {
            background-color: #a00;
            color: #fff;
            text-shadow: 0 0 5px #fff;
        }
        
        #sound-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            color: #ccc;
            cursor: pointer;
        }
        
        #jumpscare {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 10000;
            display: none;
        }
        
        #jumpscare-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .flicker {
            animation: flicker 0.3s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        #sanity-meter {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 100px;
            height: 15px;
            background-color: #003;
            border: 1px solid #005;
        }
        
        #sanity-fill {
            height: 100%;
            width: 100%;
            background-color: #00a;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="scene"></div>
        
        <div id="ui">
            <div id="health-bar">
                <div id="health-fill"></div>
            </div>
            <div id="message"></div>
            <div id="actions"></div>
        </div>
        
        <div id="inventory">
            <h3>ç‰©å“æ </h3>
            <div id="inventory-items"></div>
        </div>
        
        <div id="sanity-meter">
            <div id="sanity-fill"></div>
        </div>
        
        <div id="sound-toggle">ğŸ”Š</div>
        
        <div id="jumpscare">
            <img id="jumpscare-img" src="" alt="">
        </div>
        
        <div id="menu">
            <h1>æš—å¤œé€ƒç”Ÿ</h1>
            <div class="menu-btn" id="new-game">æ–°çš„æ¸¸æˆ</div>
            <div class="menu-btn" id="continue-game">ç»§ç»­æ¸¸æˆ</div>
            <div class="menu-btn" id="settings">è®¾ç½®</div>
        </div>
    </div>
    
    <audio id="bgm" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-dark-ambient-1471.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="footsteps">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-footsteps-on-wood-floor-1357.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="door-creak">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-creaky-door-2296.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="whisper">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-scary-whispers-566.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="scream">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-woman-screams-in-horror-1524.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="heartbeat">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-fast-heartbeat-1174.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentScene: 'entrance',
            health: 100,
            sanity: 100,
            inventory: [],
            hasFlashlight: false,
            hasKey: false,
            doorUnlocked: false,
            monsterActive: false,
            gameStarted: false,
            soundOn: true
        };
        
        // åœºæ™¯æè¿°
        const scenes = {
            entrance: {
                image: 'https://images.unsplash.com/photo-1600585152220-90363fe7e115?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                description: 'ä½ ç«™åœ¨ä¸€åº§åºŸå¼ƒçš„è€å®…å‰ã€‚æœˆå…‰é€è¿‡ä¹Œäº‘æ—¶éšæ—¶ç°ï¼Œç»™ç ´è´¥çš„å»ºç­‘è’™ä¸Šä¸€å±‚è¯¡å¼‚çš„é“¶å…‰ã€‚å‰é—¨åŠå¼€ç€ï¼Œå‘å‡ºä»¤äººä¸å®‰çš„å±å‘€å£°ã€‚',
                actions: [
                    { text: 'è¿›å…¥å‰é—¨', nextScene: 'hallway', condition: () => true, sound: 'door-creak' },
                    { text: 'ç»•åˆ°åé™¢', nextScene: 'backyard', condition: () => true },
                    { text: 'æ£€æŸ¥é‚®ç®±', nextScene: 'mailbox', condition: () => true }
                ]
            },
            hallway: {
                image: 'https://images.unsplash.com/photo-1585771724684-38269d6639fd?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                description: 'é˜´æš—çš„èµ°å»Šå»¶ä¼¸å‘é»‘æš—ä¸­ã€‚å¢™çº¸å‰¥è½ï¼Œåœ°æ¿åœ¨ä½ è„šä¸‹å±å±ä½œå“ã€‚å·¦è¾¹æ˜¯ä¸€æ‰‡å…³ç€çš„é—¨ï¼Œå³è¾¹æ¥¼æ¢¯é€šå‘äºŒæ¥¼ã€‚èµ°å»Šå°½å¤´æœ‰ä¸€é¢ç ´ç¢çš„é•œå­ã€‚',
                actions: [
                    { text: 'ä¸Šæ¥¼', nextScene: 'stairs', condition: () => true, sound: 'footsteps' },
                    { text: 'æ£€æŸ¥å·¦è¾¹çš„é—¨', nextScene: 'living-room', condition: () => true, sound: 'door-creak' },
                    { text: 'æŸ¥çœ‹é•œå­', nextScene: 'mirror', condition: () => true },
                    { text: 'è¿”å›å…¥å£', nextScene: 'entrance', condition: () => true }
                ],
                onEnter: () => {
                    if(Math.random() > 0.7 && !gameState.monsterActive) {
                        showMessage("ä½ å¬åˆ°èº«åæœ‰æ²™æ²™å£°...", 3000);
                        playSound('whisper');
                        setTimeout(() => {
                            if(gameState.currentScene === 'hallway') {
                                triggerJumpscare();
                            }
                        }, 2000);
                    }
                }
            },
            living_room: {
                image: 'https://images.unsplash.com/photo-1600607688969-a5bfcd646154?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                description: 'å®¢å…é‡Œå®¶å…·éƒ½ç›–ç€ç™½å¸ƒï¼Œåƒä¸€æ’æ’å¹½çµã€‚å£ç‚‰é‡Œè¿˜æœ‰æœªç‡ƒå°½çš„æœ¨ç‚­ã€‚ç”µè§†æœºå±å¹•ç ´ç¢ï¼Œåå°„ç€è¯¡å¼‚çš„å…‰ã€‚',
                actions: [
                    { text: 'æ£€æŸ¥å£ç‚‰', nextScene: 'fireplace', condition: () => true },
                    { text: 'æ€å¼€æ²™å‘ä¸Šçš„ç™½å¸ƒ', nextScene: 'sofa', condition: () => true },
                    { text: 'è¿”å›èµ°å»Š', nextScene: 'hallway', condition: () => true, sound: 'door-creak' }
                ],
                onEnter: () => {
                    if(!gameState.hasFlashlight && Math.random() > 0.5) {
                        gameState.hasFlashlight = true;
                        gameState.inventory.push('flashlight');
                        showMessage("ä½ åœ¨æ²™å‘ä¸‹æ‰¾åˆ°äº†ä¸€æ”¯æ‰‹ç”µç­’ï¼", 3000);
                        updateInventory();
                    }
                }
            },
            bedroom: {
                image: 'https://images.unsplash.com/photo-1584622650111-993a426fbf0a?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                description: 'å§å®¤é‡Œæœ‰ä¸€å¼ å››æŸ±åºŠï¼Œå¸·å¹”ç ´æ—§ã€‚æ¢³å¦†å°ä¸Šæ‘†æ»¡äº†å‘éœ‰çš„åŒ–å¦†å“ã€‚è¡£æŸœé—¨å¾®å¾®æ™ƒåŠ¨ï¼Œå¥½åƒåˆšåˆšæœ‰äººå…³ä¸Šäº†å®ƒã€‚',
                actions: [
                    { text: 'æ£€æŸ¥è¡£æŸœ', nextScene: 'wardrobe', condition: () => true },
                    { text: 'æŸ¥çœ‹åºŠä¸‹', nextScene: 'under-bed', condition: () => true },
                    { text: 'è¿”å›èµ°å»Š', nextScene: 'hallway', condition: () => true }
                ],
                onEnter: () => {
                    if(Math.random() > 0.8) {
                        document.getElementById('scene').classList.add('flicker');
                        showMessage("ç¯å…‰é—ªçƒ...æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨é è¿‘...", 2000);
                        setTimeout(() => {
                            document.getElementById('scene').classList.remove('flicker');
                        }, 2000);
                    }
                }
            },
            basement: {
                image: 'https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
                description: 'æ½®æ¹¿çš„åœ°ä¸‹å®¤æ•£å‘ç€éœ‰å‘³ã€‚å¢™ä¸ŠæŒ‚ç€ç”Ÿé”ˆçš„å·¥å…·ã€‚è§’è½é‡Œæœ‰ä¸€ä¸ªé”ç€çš„ç®±å­ã€‚æ¥¼æ¢¯ä¸Šæ–¹ä¼ æ¥å¥‡æ€ªçš„åˆ®æ“¦å£°ã€‚',
                actions: [
                    { text: 'æ£€æŸ¥ç®±å­', nextScene: 'chest', condition: () => true },
                    { text: 'ä¸Šæ¥¼', nextScene: 'hallway', condition: () => true, sound: 'footsteps' },
                    { text: 'æŸ¥çœ‹å·¥å…·', nextScene: 'tools', condition: () => true }
                ],
                onEnter: () => {
                    decreaseSanity(10);
                    if(!gameState.hasKey && Math.random() > 0.6) {
                        gameState.hasKey = true;
                        gameState.inventory.push('key');
                        showMessage("ä½ åœ¨å·¥å…·å †é‡Œå‘ç°äº†ä¸€æŠŠé’¥åŒ™ï¼", 3000);
                        updateInventory();
                    }
                }
            }
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            document.getElementById('new-game').addEventListener('click', startNewGame);
            document.getElementById('continue-game').addEventListener('click', continueGame);
            document.getElementById('sound-toggle').addEventListener('click', toggleSound);
            
            // åŠ è½½ä¿å­˜çš„æ¸¸æˆ
            const savedGame = localStorage.getItem('horrorEscapeGame');
            if(savedGame) {
                document.getElementById('continue-game').style.display = 'block';
            } else {
                document.getElementById('continue-game').style.display = 'none';
            }
            
            // å¼€å§‹èƒŒæ™¯éŸ³ä¹
            playSound('bgm', 0.3);
        }
        
        // å¼€å§‹æ–°æ¸¸æˆ
        function startNewGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.currentScene = 'entrance';
            gameState.health = 100;
            gameState.sanity = 100;
            gameState.inventory = [];
            gameState.hasFlashlight = false;
            gameState.hasKey = false;
            gameState.doorUnlocked = false;
            gameState.monsterActive = false;
            gameState.gameStarted = true;
            
            updateHealth();
            updateSanity();
            updateInventory();
            
            document.getElementById('menu').style.display = 'none';
            loadScene(gameState.currentScene);
        }
        
        // ç»§ç»­æ¸¸æˆ
        function continueGame() {
            const savedGame = JSON.parse(localStorage.getItem('horrorEscapeGame'));
            Object.assign(gameState, savedGame);
            gameState.gameStarted = true;
            
            updateHealth();
            updateSanity();
            updateInventory();
            
            document.getElementById('menu').style.display = 'none';
            loadScene(gameState.currentScene);
        }
        
        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('horrorEscapeGame', JSON.stringify(gameState));
        }
        
        // åŠ è½½åœºæ™¯
        function loadScene(sceneId) {
            const scene = scenes[sceneId];
            if(!scene) return;
            
            gameState.currentScene = sceneId;
            document.getElementById('scene').style.backgroundImage = `url('${scene.image}')`;
            
            // æ˜¾ç¤ºåœºæ™¯æè¿°
            showMessage(scene.description, 5000);
            
            // æ¸…é™¤æ—§åŠ¨ä½œ
            const actionsContainer = document.getElementById('actions');
            actionsContainer.innerHTML = '';
            
            // æ·»åŠ æ–°åŠ¨ä½œ
            scene.actions.forEach(action => {
                if(!action.condition || action.condition()) {
                    const btn = document.createElement('div');
                    btn.className = 'action-btn';
                    btn.textContent = action.text;
                    btn.addEventListener('click', () => {
                        if(action.sound) {
                            playSound(action.sound);
                        }
                        loadScene(action.nextScene);
                    });
                    actionsContainer.appendChild(btn);
                }
            });
            
            // æ·»åŠ ç‰©å“æ æŒ‰é’®
            const inventoryBtn = document.createElement('div');
            inventoryBtn.className = 'action-btn';
            inventoryBtn.textContent = 'ç‰©å“æ ';
            inventoryBtn.addEventListener('click', toggleInventory);
            actionsContainer.appendChild(inventoryBtn);
            
            // è°ƒç”¨åœºæ™¯è¿›å…¥äº‹ä»¶
            if(scene.onEnter) {
                scene.onEnter();
            }
            
            // éšæœºææ€–äº‹ä»¶
            if(Math.random() > 0.8 && sceneId !== 'entrance') {
                randomHorrorEvent();
            }
            
            // è‡ªåŠ¨ä¿å­˜
            saveGame();
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, duration = 3000) {
            const msgElement = document.getElementById('message');
            msgElement.textContent = text;
            msgElement.style.display = 'block';
            
            if(duration > 0) {
                setTimeout(() => {
                    msgElement.style.display = 'none';
                }, duration);
            }
        }
        
        // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
        function updateHealth() {
            document.getElementById('health-fill').style.width = `${gameState.health}%`;
        }
        
        // æ›´æ–°ç†æ™ºå€¼æ˜¾ç¤º
        function updateSanity() {
            document.getElementById('sanity-fill').style.width = `${gameState.sanity}%`;
            
            // ç†æ™ºå€¼ä½çš„æ•ˆæœ
            if(gameState.sanity < 30) {
                document.body.style.filter = 'hue-rotate(90deg)';
                if(Math.random() > 0.9) {
                    showMessage("ä½ å¼€å§‹äº§ç”Ÿå¹»è§‰...æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨çœ‹ç€ä½ ...", 2000);
                }
            } else {
                document.body.style.filter = 'none';
            }
        }
        
        // å‡å°‘ç†æ™ºå€¼
        function decreaseSanity(amount) {
            gameState.sanity = Math.max(0, gameState.sanity - amount);
            updateSanity();
            
            if(gameState.sanity <= 0) {
                gameOver("ä½ çš„ç†æ™ºå´©æºƒäº†ï¼Œé™·å…¥äº†ç–¯ç‹‚...");
            }
        }
        
        // æ›´æ–°ç‰©å“æ 
        function updateInventory() {
            const inventoryItems = document.getElementById('inventory-items');
            inventoryItems.innerHTML = '';
            
            gameState.inventory.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.textContent = item === 'flashlight' ? 'ğŸ”¦' : item === 'key' ? 'ğŸ”‘' : '?';
                itemElement.addEventListener('click', () => useItem(item));
                inventoryItems.appendChild(itemElement);
            });
        }
        
        // ä½¿ç”¨ç‰©å“
        function useItem(item) {
            if(item === 'flashlight') {
                showMessage("ä½ æ‰“å¼€äº†æ‰‹ç”µç­’ï¼Œå‘¨å›´äº®äº†èµ·æ¥ã€‚", 2000);
                document.getElementById('scene').style.filter = 'brightness(1.5)';
                setTimeout(() => {
                    document.getElementById('scene').style.filter = 'brightness(1)';
                }, 2000);
            } else if(item === 'key' && gameState.currentScene === 'chest') {
                showMessage("ä½ ç”¨é’¥åŒ™æ‰“å¼€äº†ç®±å­ï¼é‡Œé¢æœ‰ä¸€å¼ çº¸æ¡ï¼š'å¿«é€ƒ...å®ƒæ¥äº†...'", 4000);
                gameState.doorUnlocked = true;
            }
        }
        
        // åˆ‡æ¢ç‰©å“æ æ˜¾ç¤º
        function toggleInventory() {
            const inventory = document.getElementById('inventory');
            inventory.style.display = inventory.style.display === 'block' ? 'none' : 'block';
        }
        
        // éšæœºææ€–äº‹ä»¶
        function randomHorrorEvent() {
            const events = [
                () => {
                    showMessage("ä½ å¬åˆ°è¿œå¤„ä¼ æ¥ä½è¯­å£°...", 2000);
                    playSound('whisper');
                    decreaseSanity(5);
                },
                () => {
                    showMessage("å¢™ä¸Šçš„é˜´å½±ä¼¼ä¹åœ¨ç§»åŠ¨...", 2000);
                    decreaseSanity(8);
                },
                () => {
                    if(!gameState.monsterActive) {
                        showMessage("æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨è·Ÿç€ä½ ...", 2000);
                        playSound('footsteps');
                        setTimeout(() => {
                            if(Math.random() > 0.5) {
                                triggerJumpscare();
                            }
                        }, 3000);
                    }
                }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            randomEvent();
        }
        
        // è§¦å‘è·³å“
        function triggerJumpscare() {
            gameState.monsterActive = true;
            playSound('scream');
            
            const jumpscare = document.getElementById('jumpscare');
            const jumpscareImg = document.getElementById('jumpscare-img');
            
            // éšæœºé€‰æ‹©è·³å“å›¾ç‰‡
            const jumpscares = [
                'https://i.imgur.com/XdQaZQj.jpg',
                'https://i.imgur.com/Yq9WQvJ.jpg',
                'https://i.imgur.com/Zq9WQvJ.jpg'
            ];
            
            jumpscareImg.src = jumpscares[Math.floor(Math.random() * jumpscares.length)];
            jumpscare.style.display = 'block';
            
            setTimeout(() => {
                jumpscare.style.display = 'none';
                gameState.health -= 20;
                gameState.sanity -= 30;
                updateHealth();
                updateSanity();
                
                if(gameState.health <= 0) {
                    gameOver("ä½ è¢«ææ€–çš„ç”Ÿç‰©æ€æ­»äº†...");
                } else {
                    showMessage("ä½ å‹‰å¼ºé€ƒè„±äº†ï¼Œä½†å—äº†ä¼¤...", 3000);
                    gameState.monsterActive = false;
                }
            }, 1000);
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver(message) {
            showMessage(message, 0);
            playSound('heartbeat');
            
            const actionsContainer = document.getElementById('actions');
            actionsContainer.innerHTML = '';
            
            const restartBtn = document.createElement('div');
            restartBtn.className = 'action-btn';
            restartBtn.textContent = 'é‡æ–°å¼€å§‹';
            restartBtn.addEventListener('click', () => {
                document.location.reload();
            });
            actionsContainer.appendChild(restartBtn);
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(soundId, volume = 1.0) {
            if(!gameState.soundOn) return;
            
            const sound = document.getElementById(soundId);
            sound.volume = volume;
            sound.currentTime = 0;
            sound.play().catch(e => console.log("æ— æ³•æ’­æ”¾å£°éŸ³:", e));
        }
        
        // åˆ‡æ¢å£°éŸ³
        function toggleSound() {
            gameState.soundOn = !gameState.soundOn;
            document.getElementById('sound-toggle').textContent = gameState.soundOn ? 'ğŸ”Š' : 'ğŸ”‡';
            
            if(gameState.soundOn) {
                playSound('bgm', 0.3);
            } else {
                document.getElementById('bgm').pause();
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>